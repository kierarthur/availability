<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111" />
  <link rel="manifest" href="manifest.json" />
  <title>Availability</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #161a22;
      --muted: #a7b0c0;
      --text: #e7ecf3;
      --accent: #4f8cff;
      --danger: #e06666;
      --ok: #6aa84f;
      --warn: #c8a94a;
      --tile: #1b212c;
      --tile-hover: #222a38;
      --booked: #4a86e8;
      --blocked: #6aa84f;

      /* Reserved dynamically by JS so content never sits under the fixed footer */
      --footer-h: 76px;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      /* Allow vertical scrolling so tiles can grow as needed */
      height: 100%;
      overflow-x: hidden;
      overflow-y: auto;

      /* iOS text zoom can mess with measurements; keep it steady */
      -webkit-text-size-adjust: 100%;
    }

    header {
      position: sticky; top: 0; z-index: 10;
      display: flex; align-items: center; gap: .6rem; flex-wrap: wrap;
      padding: .6rem .9rem;
      background: rgba(15,17,21,.9); backdrop-filter: blur(6px);
      border-bottom: 1px solid #222936;
      overflow: visible; /* allow overlay logo to extend */
    }

    /* Candidate name + overlay container */
    .name-and-logo {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.2rem;
      z-index: 2;
    }

    #candidateName {
      margin: 0;
      font-size: 1.35rem;
      line-height: 1.1;
      font-weight: 800;
      letter-spacing: .2px;
      position: relative;
      z-index: 2;
    }

    /* Overlayed logo (does not take layout space) */
    .company-logo-overlay {
      position: absolute;
      left: 0;
      top: calc(100% + 4px);
      z-index: 1;
      pointer-events: none;
      opacity: 0.25;
      width: auto; height: auto;
      max-width: min(65vw, 520px);
      max-height: 280px;
    }
    @media (max-width: 900px) {
      .company-logo-overlay { max-width: min(70vw, 420px); max-height: 220px; opacity: 0.22; }
    }
    @media (max-width: 560px) {
      .company-logo-overlay { max-width: 60vw; max-height: 180px; opacity: 0.20; }
    }

    header .spacer { flex: 1; }

    button, .btn {
      appearance: none; border: 0; outline: 0; cursor: pointer;
      border-radius: 10px; padding: .5rem .7rem; font-weight: 600; font-size: .9rem;
      background: var(--panel); color: var(--text);
      transition: background .15s ease, opacity .15s ease;
      position: relative; z-index: 2;
    }
    button:hover { background: #1e2532; }
    button:disabled { opacity: .55; cursor: not-allowed; }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-ghost { background: transparent; color: var(--muted); }

    main {
      max-width: 1024px;
      width: 100%;
      margin: 0 auto;
      padding: .6rem .9rem 0;
      box-sizing: border-box;

      /* Critical: reserve real footer height so content never sits underneath */
      padding-bottom: calc(var(--footer-h) + env(safe-area-inset-bottom));
      scroll-padding-bottom: calc(var(--footer-h) + env(safe-area-inset-bottom) + 12px);
    }

    #helpMsg {
      display: block;
      margin: .15rem 0 .6rem;
      padding: .45rem .6rem;
      border-radius: 10px; font-size: .9rem;
      color: var(--muted);
      border: 1px solid #2a3446;
      background: #131926;
      position: relative;
      z-index: 1;
    }

    /* Grid: responsive columns; rows grow to fit tallest tile in that row */
    .grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: .6rem;
      width: 100%;
      max-width: 100%;
    }
    @media (max-width: 900px) { .grid { grid-template-columns: repeat(5, 1fr); } }
    @media (max-width: 700px) { .grid { grid-template-columns: repeat(4, 1fr); } }
    @media (max-width: 560px) { .grid { grid-template-columns: repeat(3, 1fr); } }

    /* Tiles: let content dictate height. No clamps, no hidden overflow. */
    .tile {
      background: var(--tile);
      border: 1px solid #222a36;
      border-radius: 14px;
      padding: .6rem;
      display: grid;
      grid-template-rows: auto auto auto; /* header, status, sub */
      transition: background .15s ease;
    }
    .tile:hover { background: var(--tile-hover); }

    .tile-header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: .1rem;
    }
    .tile-day {
      font-weight: 800;
      letter-spacing: .5px;
      font-size: .95rem;
      color: var(--muted);
      text-transform: uppercase;
      line-height: 1.2;
      word-break: break-word;
      overflow-wrap: anywhere;
    }
    .tile-date {
      font-size: .95rem;
      color: var(--text);
      font-weight: 700;
      margin-left: 0.05rem;
      line-height: 1.2;
      word-break: break-word;
      overflow-wrap: anywhere;
    }

    .tile-status {
      margin-top: .3rem;
      font-size: 1rem;
      font-weight: 800;
      line-height: 1.25;
      /* No clamps; always wrap */
      word-break: break-word;
      overflow-wrap: anywhere;
    }
    .status-pending { color: var(--muted); }
    .status-na      { color: var(--danger); }
    .status-ld,
    .status-n,
    .status-ldn     { color: var(--warn); }
    .status-booked  { color: var(--booked); }
    .status-blocked { color: var(--blocked); }

    .tile-sub {
      margin-top: .25rem;
      color: var(--muted);
      font-size: .9rem;
      line-height: 1.25;
      /* No clamps; always wrap */
      word-break: break-word;
      overflow-wrap: anywhere;
    }
    .tile .edit-note { color: var(--accent); font-size: .85rem; }

    /* Footer is fixed at the very bottom; we reserve its height in <main> */
    .footer {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      z-index: 20;
      background: rgba(15,17,21,.97);
      backdrop-filter: blur(6px);
      border-top: 1px solid #222936;
      /* Vertical padding includes safe-area so the button sits as low as possible */
      padding: .55rem .9rem calc(.55rem + env(safe-area-inset-bottom));
      box-sizing: border-box;
      width: 100%;
    }
    .footer-inner {
      max-width: 1024px; margin: 0 auto;
      display: flex; gap: .6rem; align-items: center;
      width: 100%;
    }
    .footer .spacer { flex: 1; }

    .banner {
      padding: .5rem .7rem; border-radius: 10px; font-size: .9rem;
      border: 1px solid #2a3446; background: #131926; color: #a7b0c0;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      max-width: 50vw;
    }

    /* When hidden, keep the element but measure as zero height so JS can update */
    .hidden {
      visibility: hidden !important;
      pointer-events: none !important;
      opacity: 0;
      height: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      border-top-width: 0 !important;
    }

    .toast {
      position: fixed; right: .75rem; bottom: calc(5.25rem + env(safe-area-inset-bottom));
      background: #131926; color: var(--text);
      border: 1px solid #2a3446; padding: .6rem .75rem; border-radius: 10px; z-index: 25;
      box-shadow: 0 8px 30px rgba(0,0,0,.35);
      max-width: 90vw; font-size: .9rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="name-and-logo">
      <h1 id="candidateName"></h1>
      <!-- Overlayed logo (does not affect layout) -->
      <img src="ARMSLOGO.png" alt="Company Logo" class="company-logo-overlay" />
    </div>
    <div class="spacer"></div>
    <button id="refreshBtn">Refresh</button>
    <button id="installBtn" class="btn-ghost hidden">Install</button>
  </header>

  <main>
    <div id="helpMsg">
      Please tap any date to change your availability — don’t forget to tap <strong>Submit</strong> when you’re done.
    </div>
    <div id="grid" class="grid"></div>
  </main>

  <!-- Fixed footer; we reserve its space in <main> via JS-set --footer-h -->
  <div id="footer" class="footer hidden" role="region" aria-label="Submission actions">
    <div class="footer-inner">
      <span id="draftMsg" class="banner">You have unsaved changes.</span>
      <div class="spacer"></div>
      <button id="clearBtn" class="btn">Clear changes</button>
      <button id="submitBtn" class="btn-primary">Submit</button>
    </div>
  </div>

  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

  <!-- Your app logic -->
  <script src="app.js"></script>

  <!-- Footer measurement + safe, universal scrolling layout -->
  <script>
    (function () {
      const FOOTER_SEL = '#footer';

      function measureFooter() {
        const footer = document.querySelector(FOOTER_SEL);
        if (!footer) return;

        // Temporarily ensure it's measurable even when "hidden"
        const wasHidden = footer.classList.contains('hidden');
        if (wasHidden) footer.classList.remove('hidden');

        // Compute the true rendered height (includes safe-area padding)
        const rect = footer.getBoundingClientRect();
        let h = Math.max(0, Math.round(rect.height));

        // Put it back if it was hidden
        if (wasHidden) footer.classList.add('hidden');

        // Publish as CSS var; <main> uses it to reserve bottom space
        document.documentElement.style.setProperty('--footer-h', h + 'px');
      }

      // Measure at key times
      window.addEventListener('load', () => {
        measureFooter();
        // iOS toolbars can settle late — one more pass
        setTimeout(measureFooter, 250);
      });
      window.addEventListener('resize', measureFooter);
      window.addEventListener('orientationchange', () => setTimeout(measureFooter, 200));

      // React when footer visibility toggles (e.g., unsaved changes)
      const footer = document.querySelector(FOOTER_SEL);
      if (footer && window.MutationObserver) {
        const mo = new MutationObserver(() => {
          // when shown/hidden, re-measure to keep padding-bottom perfect
          measureFooter();
        });
        mo.observe(footer, { attributes: true, attributeFilter: ['class', 'style'] });
      }
    })();
  </script>
</body>
</html>
